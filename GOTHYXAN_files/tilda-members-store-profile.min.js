var isFormChanged=!1;function setupFormChangeTracking(e){e.addEventListener("input",function(){isFormChanged=!0})}function setupBeforeUnloadWarning(){window.addEventListener("beforeunload",function(e){isFormChanged&&(e.preventDefault(),e.returnValue="")})}function tmst_profile__initPage(){tmst_profile__initializeProfileContainer(),tmst_profile__initializeUserbarWidget(),tmst__addHeaderFooter(),tmst__applyStyles(),tmst__installCart(),tmst__addBgIfNeeded();var e=tma__getPath();e[2]?"password"===e[2]?tmst_profile__renderPasswordPage():document.location.replace("/members/profile"):tmst_profile__renderProfilePage(),tma__showDocumentReady()}function tmst_profile__renderProfilePage(){document.title=tma__translate("{{form_edit_profile_title}}","userbar_dict"),tmst_profile__drawBreadcrumbs(),tmst_profile__drawProfilePageContent(),tmst_profile__initPhoneMask(),tma__profile__initTooltips(),tmst_profile__setupDropdownHandlers(),tmst_profile__setupFormSubmitHandler(),tmst_profile__setupInvalidPhoneHandler(),tmst_profile__setupLanguageSelectorHandler();var e=document.getElementById("form-change-profile");e&&(setupFormChangeTracking(e),setupBeforeUnloadWarning())}function tmst_profile__renderPasswordPage(){document.title=tma__translate("{{change_password_title}}","userbar_dict"),tmst_profile__drawBreadcrumbs(!0),tmst_profile__drawPasswordPageContent(),tmst_profile__setupPasswordToggleHandlers(),tmst_profile__setupPasswordFormSubmitHandler()}function tmst_profile__drawPasswordPageContent(){var e,t=document.querySelector(".tmst-profile");t&&(e="",e=(e+='<div class="tmst-container"><div class="tmst-profile-content-wrapper"><div class="tmst-profile-title" data-field="tlk-title">{{change_password_title}}</div>')+tmst_profile__getPasswordForm()+"</div></div>",t.insertAdjacentHTML("beforeend",tma__translate(e,"userbar_dict")))}function tmst_profile__getPasswordForm(){var e="";return e+'<form method="post" id="form-change-password" class="tmst-password-form" action="/api/editpassword/">'+'<div class="tlk-profile__form-wrap">'+tmst_profile__getPasswordField("current-password","{{current_password_label}}")+tmst_profile__getPasswordField("new-password","{{new_password_label}}")+tmst_profile__getPasswordField("confirm-password","{{confirm_password_label}}")+"</div>"+'<div class="tlk-input-error tlk-input-error_all"></div>'+tmst_profile__getPasswordFormButtons()+"</form>"}function tmst_profile__getPasswordField(e,t){var o="";return o+'<div class="tlk-profile__item tlk-form__item">'+('<div class="tlk-input-title" data-field="tlk-text">'+t+"</div>")+'<div class="tlk-password-input-wrapper">'+('<input type="password" id="'+e+'" name="'+e+'" class="tlk-input" required>')+'<div class="tlk-password-toggle">'+'<span class="tlk-password-icon tlk-password-icon-hidden"></span>'+"</div>"+"</div>"+'<div class="tlk-input-error"></div>'+"</div>"}function tmst_profile__setupPasswordToggleHandlers(){document.querySelectorAll(".tlk-password-toggle").forEach(function(e){e.addEventListener("click",function(){tmst_profile__handlePasswordToggleClick(e)})})}function tmst_profile__handlePasswordToggleClick(e){var t=e.previousElementSibling;t instanceof HTMLInputElement&&("password"===t.type?(t.type="text",e.classList.add("tlk-password-visible"),e.querySelector(".tlk-password-icon").classList.remove("tlk-password-icon-hidden"),e.querySelector(".tlk-password-icon").classList.add("tlk-password-icon-visible")):(t.type="password",e.classList.remove("tlk-password-visible"),e.querySelector(".tlk-password-icon").classList.remove("tlk-password-icon-visible"),e.querySelector(".tlk-password-icon").classList.add("tlk-password-icon-hidden")))}function tmst_profile__getPasswordFormButtons(){var e=tmst_profile__getButtonColorClassnameSuffix(),t="";return t+'<div class="tlk-profile__buttons">'+('<a href="/members/profile" class="tlk-profile__cancel-button tlk-profile__cancel-button__'+e+' tlk-btn">')+"{{form_change_password_btn_cancel}}"+"</a>"+('<button type="submit" class="tlk-profile__close-save tlk-profile__close-save__'+e+' tlk-btn">')+"{{change_password_button}}"+"</button>"+"</div>"}function tmst_profile__setupPasswordFormSubmitHandler(){var r=document.getElementById("form-change-password");r&&r.addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation();var e=document.querySelector("#form-change-password"),t=r.querySelector("#current-password"),o=r.querySelector("#new-password"),i=r.querySelector("#confirm-password");tma__resetErrorRequest(e),tma__resetErrorFields(e),o.value!==i.value?tmst_profile__showValidationErrors(e,[{role:"password",input:"confirm-password",field:"confirmPassword",type:"do_not_match"}]):(i=tma__getProfileObjFromLS(),tmst_profile__submitChangePassword({newpassword:o.value,password:t.value,projectid:i.projectid,token:i.token,tzoffset:window.tildaMembers.timezoneOffset||(new Date).getTimezoneOffset()}))})}function tmst_profile__submitChangePassword(e){var t=document.querySelector(".tlk-profile__close-save"),o=(t.disabled=!0,document.querySelector("#form-change-password"));tma__request("/api/editpassword/",JSON.stringify(e),t,function(e){"ok"===e.status?document.location.assign("/members/profile"):(e=e.code||e.data,tma__showErrorRequest(o,e,"userbar_dict","change_password"))})}function tmst_profile__initializeProfileContainer(){var e=tma__checkContainerDiv("tmst-profile");return e.classList.add("tmst-wrap"),e}function tmst_profile__drawBreadcrumbs(e=!1){var t,o,i=document.querySelector(".tmst-profile");i&&(t=[],(o=tma__getProfileObjFromLS())&&0===o.courses.length&&1===o.groups.length&&(o.groups[0].homepage||"0"!==o.groups[0].homepage)&&o.groups[0].index||t.push({label:tma__translate("{{personal_account}}","store_dict"),href:"/members/"}),t.push({label:tma__translate("{{profile}}","store_dict"),href:"/members/profile"}),e&&t.push({label:tma__translate("{{change_password_title}}","userbar_dict"),href:"/members/profile/password"}),o=tmst__createBreadcrumbsEl(t),i.insertAdjacentElement("afterbegin",o))}function tmst_profile__initializeUserbarWidget(){tma__onFuncLoad("tma__userbar__drawWidget",function(){tma__userbar__drawWidget()})}function tmst_profile__setupFormSubmitHandler(){var t=document.getElementById("form-change-profile");t&&t.addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation(),tmst_profile__submitEditProfile(t)})}function tmst_profile__setupInvalidPhoneHandler(){var e,t=document.getElementById("form-change-profile");t&&(e=t.querySelector(".js-invalid-phone-input"))&&e.addEventListener("focus",function(){tmst_profile__replaceInvalidPhoneInput(e,t)})}function tmst_profile__replaceInvalidPhoneInput(e,t){var o=tmst_profile__createPhoneInputHtml({name:e.name||"phone",placeholder:e.placeholder||"",value:e.value||"",required:e.required||!1}),o=(e.insertAdjacentHTML("beforebegin",o),e.parentNode.removeChild(e),tmst_profile__initPhoneMask(),t.querySelector(".t-input-phonemask"));o&&o.focus()}function tmst_profile__initPhoneMask(){"function"!=typeof window.t_form_phonemask__initPhoneMask&&tma__loadJS("https://static.tildacdn.com/js/tilda-phone-mask-1.1.min.js"),tma__onFuncLoad("t_form_phonemask__initPhoneMask",function(){document.querySelectorAll(".js-phonemask-input").forEach(e=>{var t,o=e.closest(".t-input-group");o&&(t=e.value,e.value="",t_form_phonemask_load(e),t)&&tma__onFuncLoad("t_form_phonemask__setValue",function(){"yes"===o.getAttribute("data-init-mask")?t_form_phonemask__setValue(o,t):o.addEventListener("phoneMaskReady",()=>{t_form_phonemask__setValue(o,t)})})})})}function tma__profile__initTooltips(){var e=document.querySelectorAll(".js-invaid-phone-icon");e.length&&e.forEach(function(e){tma__drawTooltip({element:e,tooltipClass:"tlk-tooltip_theme_dark"})})}function tmst_profile__drawProfilePageContent(){var e,t,o=document.querySelector(".tmst-profile");o&&(t="",t=(t=(t=(t+='<div class="tmst-container"><div class="tmst-profile-content-wrapper"><div class="tmst-profile-title" data-field="tlk-title">{{form_edit_profile_title}}</div><div class="tmst-profile-content"><div class="tmst-profile-content__left">')+tmst_profile__getProfileFormHtml(e=tma__getProfileObjFromLS())+'</div><div class="tmst-profile-content__right tlk-upload">')+tmst_profile__getProfileImageHtml(e))+tmst_profile__getChangeProfileImageButtonHtml()+"</div></div></div></div>",o.insertAdjacentHTML("beforeend",tma__translate(t,"userbar_dict")))}function tmst_profile__getProfileImageHtml(e){var t="";return(t+='<div class="tlk-profile__item tlk-form__item">')+'<div class="tlk-input-title" data-field="tlk-text">{{form_edit_profile_field_profile_image}}</div>'+'<div class="tlk-upload__preview">'+tmst_profile__getLogoHtml(e)+"</div>"+"</div>"}function tmst_profile__getLogoHtml(e={}){var t="";return e.memberlogo&&window.tildaMembers.upload?(window.tildaMembers.upload.id=e.memberlogo_uuid,t+='<img src="'+e.memberlogo+'" alt="profile-image" onerror="tmst_profile__handleImageLoadError(this)">'):t+=tmst_profile__getDefaultLogoHtml(),t}function tmst_profile__handleImageLoadError(e){var t=e.parentElement;t&&(t.removeChild(e),t.insertAdjacentHTML("beforeend",tmst_profile__getDefaultLogoHtml()),document.querySelector(".js-delete-item").outerHTML="")}function tmst_profile__getDefaultLogoHtml(){return'<div class="tlk-upload__default-preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 37 41" fill="none"><circle cx="18.5" cy="11.5" r="10.75" stroke="currentColor" stroke-width="1.5"/><path d="M36 41C36 32.7157 28.165 26 18.5 26C8.83502 26 1 32.7157 1 41" stroke="currentColor" stroke-width="1.5"/></svg></div>'}function tmst_profile__getChangeProfileImageButtonHtml(){var e=(e=(e=(e=(e=(e=(e="")+'<div class="tlk-upload-wrapper">'+'<div class="tlk-profile-dropdown">')+'<button class="tlk-profile__regular-button">{{edit_button}}</button>'+'<div class="tlk-profile-dropdown-menu">')+'<div class="tlk-profile-dropdown-arrow"></div>'+'<ul class="tlk-profile-dropdown-list js-image-menu">')+'<li class="tlk-profile-dropdown-item js-upload-item">'+'<label class="tlk-upload-label">')+"{{upload_image_menu_item}}"+'<input type="file" class="tlk-upload-input" accept="image/*" style="display: none;">')+"</label>"+"</li>";return tma__getProfileObjFromLS().memberlogo&&window.tildaMembers.upload&&(e+='<li class="tlk-profile-dropdown-item js-delete-item">{{delete_image_menu_item}}</li>'),e=(e=(e+="</ul>")+"</div>"+"</div>")+'<div class="tlk-upload__error"></div>'+"</div>"}function tmst_profile__setupDropdownHandlers(){var e,t,o=document.querySelector(".tlk-profile-dropdown"),i=document.querySelector(".tlk-profile-dropdown-menu");o&&i&&(e=o.querySelector("button"))&&(t=i.querySelector(".tlk-upload-input"),i=i.querySelector(".js-delete-item"),e.addEventListener("click",e=>{e.stopPropagation(),o.classList.toggle("show")}),document.addEventListener("click",e=>{e.target instanceof Node&&o.contains(e.target)||o.classList.remove("show")}),t.addEventListener("change",tmst_profile__handleImageUpload),i)&&i.addEventListener("click",tmst_profile__handleImageDelete)}function tmst_profile__handleImageUpload(){var e,t,o=document.querySelector(".tlk-upload"),i=o.querySelector('input[type="file"]'),r=o.querySelector(".tlk-upload__preview"),o=o.querySelector(".tlk-upload__error"),l=document.querySelector(".tlk-profile-dropdown");l&&(l.classList.remove("show"),e=(l=i.files[0]).size/1048576,t=["image/png","image/jpg","image/jpeg","image/gif"].includes(l.type),o.classList.remove("tlk-upload__error_show"),o.textContent="",t?2<e?(o.textContent=tma__translate("{{field_file_size}}","userbar_dict"),o.classList.add("tlk-upload__error_show"),i.value=""):tmst_profile__uploadImage(l,r,o):(o.textContent=tma__translate("{{field_file_type}}","userbar_dict"),o.classList.add("tlk-upload__error_show"),i.value=""))}function tmst_profile__uploadImage(e,i,r){var t=tma__getProfileObjFromLS(),o=new FormData,l=(o.append("projectid",t.projectid),o.append("token",t.token),o.append("file",e),o.append("tzoffset",(new Date).getTimezoneOffset().toString()),document.querySelector(".tlk-profile__close-save"));l.disabled=!0,tma__request("/api/uploadmemberlogo/",o,l,function(e){var t,o;"ok"===e.status&&e.data?(window.tildaMembers.upload.id=e.data.uuid,i.innerHTML=`<img src="${e.data.cdnurl}">`,tmst_profile__addDeleteItem(),(t=document.getElementById("form-change-profile"))&&(o=new Event("input",{bubbles:!0}),t.dispatchEvent(o))):(r.textContent=tma__translate(`{{upload_logo_${e.code}}}`,"userbar_dict"),r.classList.add("tlk-upload__error_show")),l.disabled=!1},!0)}function tmst_profile__addDeleteItem(){var e,t=document.querySelector(".js-image-menu");!t||(e=document.querySelector(".js-delete-item"))||((e=document.createElement("li")).className="tlk-profile-dropdown-item js-delete-item",e.insertAdjacentHTML("beforeend",tma__translate("{{delete_image_menu_item}}","userbar_dict")),e.addEventListener("click",tmst_profile__handleImageDelete),t.insertAdjacentElement("beforeend",e))}function tmst_profile__handleImageDelete(){var e=document.querySelector(".tlk-upload"),t=e.querySelector('input[type="file"]'),e=e.querySelector(".tlk-upload__preview"),o=document.querySelector(".tlk-profile-dropdown");o&&(o.classList.remove("show"),window.tildaMembers.upload.id="",t.value="",e.innerHTML=tmst_profile__getLogoHtml({}),document.querySelector(".js-delete-item").outerHTML="")}function tmst_profile__getProfileFormHtml(e){var t=(t=(t=(t=(t='<form method="post" id="form-change-profile" action="/api/editprofile/"><div class="tlk-profile__form-wrap">')+tmst_profile__getNameFieldHTML(e))+tmst_profile__getLoginFieldHTML(e))+tmst_profile__getPhoneFieldHTML(e))+tmst_profile__getLanguageSelectorHTML();return window.tildaMembers&&(!window.tildaMembers.settingStyles||!window.tildaMembers.settingStyles.authsettings||window.tildaMembers.settingStyles&&window.tildaMembers.settingStyles.authsettings&&"password"===window.tildaMembers.settingStyles.authsettings.authtypeid)&&(t+=tmst_profile__getChangePasswordButtonHTML()),t=(t=(t=(t+="</div>")+'<div class="tlk-input-error tlk-input-error_all"></div>'+'<div class="tlk-profile__buttons">')+tmst_profile__getSaveButtonHTML())+"</div>"+"</form>"}function tmst_profile__getSaveButtonHTML(e="default"){var t=tmst_profile__getButtonColorClassnameSuffix();return tma__translate('<button type="submit" class="js-profile-save tlk-profile__close-save tlk-profile__close-save__'+e+" tlk-profile__close-save__"+t+' tlk-btn">{{form_edit_profile_btn_save_'+e+"}}</button>","userbar_dict")}function tmst_profile__getButtonColorClassnameSuffix(){let e="#FFFFFF";return tmst_profile__isLightColor(e=window.tildaMembers&&window.tildaMembers.settingStyles&&window.tildaMembers.settingStyles.welcomepage&&window.tildaMembers.settingStyles.welcomepage.boxBackgroundColor?window.tildaMembers.settingStyles.welcomepage.boxBackgroundColor:e)?"dark":"light"}function tmst_profile__isLightColor(e){var[e,t,o]=tmst__hexToRgb(e).map(e=>{e/=255;return e<=.03928?e/12.92:Math.pow((.055+e)/1.055,2.4)});return.5<.2126*e+.7152*t+.0722*o}function tmst_profile__getNameFieldHTML(e){var t="";return t+'<div class="tlk-profile__item tlk-form__item">'+'<div class="tlk-input-title" data-field="tlk-text">{{form_edit_profile_field_name}}</div>'+('<input type="text" name="name" placeholder="{{form_edit_profile_placeholder_name}}" class="tlk-input" value="'+tma__escapeHTML(e.name)+'" required>')+'<div class="tlk-input-error"></div>'+"</div>"}function getIsLoginFieldDisabled(e){var t=tmst_profile__getLoginType();return!e.allowEditProfile&&!!e.login&&("email"===t||tmst_sign__getAreBothLoginTypesActive())}function tmst_profile__getLoginFieldHTML(e){var t=getIsLoginFieldDisabled(e),o=tmst_profile__getLoginType(),i="",i=(i+='<div class="tlk-profile__item tlk-form__item">')+'<div class="tlk-input-title" data-field="tlk-text">{{form_edit_profile_field_email}}</div>'+('<input type="text"autocomplete="email" name="login" placeholder="{{form_edit_profile_placeholder_email}}" class="tlk-input" value="'+(e.login||"")+'"'+(!t&&"email"===o?" required":"")+(t?" disabled":"")+">");return t&&(i+='<input type="hidden" name="login" value="'+(e.login||"")+'">'),i=i+'<div class="tlk-input-error"></div>'+"</div>"}function getIsPhoneFieldDisabled(e){var t=tmst_profile__getLoginType();return!e.allowEditProfile&&!!e.phone&&("phone"===t||tmst_sign__getAreBothLoginTypesActive())}function tmst_profile__getPhoneFieldHTML(e){var t=getIsPhoneFieldDisabled(e),o=tmst_profile__getLoginType(),o=!t&&"phone"===o,i=e.isPhoneValid,r=['type="text"','name="phone"','autocomplete="tel"','placeholder="{{form_edit_profile_placeholder_phone}}"','class="tlk-input"','value="'+(e.phone||"")+'"',o?"required":"",t?"disabled":""].filter(Boolean).join(" "),l=t?'<input type="hidden" name="phone" value="'+(e.phone||"")+'">':"";return'<div class="tlk-profile__item tlk-form__item"><div class="tlk-input-title" data-field="tlk-text"><span>{{form_edit_profile_field_phone}}</span>'+(i?"":'<svg class="tlk-popup__warning-icon js-invaid-phone-icon" width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg" data-tooltip-text="{{widget_userbar_warning_phone}}"><path d="M17 8.5C17 13.1944 13.1944 17 8.5 17C3.80558 17 0 13.1944 0 8.5C0 3.80558 3.80558 0 8.5 0C13.1944 0 17 3.80558 17 8.5Z" fill="#EA3323"/><path d="M8.25488 10.1543L7.89844 6.52148V4.8418H9.38281V6.52148L9.03125 10.1543H8.25488ZM7.95703 12V10.6279H9.3291V12H7.95703Z" fill="white"/></svg>')+"</div>"+(i?tmst_profile__createPhoneInputHtml({name:"phone",placeholder:"{{form_edit_profile_placeholder_phone}}",disabled:t,value:e.phone,required:o}):"<input "+r+">")+l+'<div class="tlk-input-error"></div></div>'}function tmst_profile__getLanguageSelectorHTML(){var t=window.tildaMembers.userLang||"RU",e=["RU","EN","DE","ES","PT","LV","UK"].map(function(e){return'<li data-value="'+e+'" class="'+(t===e?"selected":"")+'">{{form_edit_profile_lang_option_'+e.toLowerCase()+"}}</li>"}).join("");return'<div class="tlk-profile__item tlk-form__item"><div class="tlk-input-title" data-field="tlk-text">{{form_edit_profile_field_lang}}</div><div class="tlk-select-custom"><div class="tlk-select-custom__selected" tabindex="0">{{form_edit_profile_lang_option_'+t.toLowerCase()+'}}</div><ul class="tlk-select-custom__options">'+e+'</ul></div><input name="lang" type="hidden" class="tlk-profile__change-lang" value="'+t+'"/></div>'}function tmst_profile__setupLanguageSelectorHandler(){document.addEventListener("click",function(e){var t,o=e.target.closest(".tlk-select-custom"),i=document.querySelectorAll(".tlk-select-custom");Array.prototype.forEach.call(i,function(e){e!==o&&e.classList.remove("open")}),o&&(i=o.querySelector(".tlk-select-custom__options"),t=o.querySelector(".tlk-select-custom__selected"),o.classList.toggle("open"),"LI"===e.target.tagName)&&(t.textContent=e.target.textContent,Array.prototype.forEach.call(i.querySelectorAll("li"),function(e){e.classList.remove("selected")}),e.target.classList.add("selected"),(t=document.querySelector(".tlk-profile__change-lang"))&&(t.value=e.target.getAttribute("data-value"),i=new Event("input",{bubbles:!0}),t.dispatchEvent(i)),o.classList.remove("open"))})}function tmst_profile__getChangePasswordButtonHTML(){return'<div class="tlk-profile__item tlk-form__item"><div class="tlk-input-title" data-field="tlk-text">{{password_title}}</div><a type="button" href="/members/profile/password" class="tlk-profile__regular-button">{{form_edit_profile_btn_change_password}}</a></div>'}function tmst_profile__getActiveLoginTypes(){var e;return window.tildaMembers.settingStyles&&window.tildaMembers.settingStyles.authsettings?0===(e=window.tildaMembers.settingStyles.authsettings.activeLoginTypes||[]).length?[window.tildaMembers.settingStyles.authsettings.logintypeid||"email"]:e:["email"]}function tmst_profile__getLoginType(){return tmst_profile__getActiveLoginTypes()[0]}function tmst_sign__getAreBothLoginTypesActive(){var e=tmst_profile__getActiveLoginTypes();return 2===e.length&&e.every(e=>["email","phone"].includes(e))}function tmst_profile__createPhoneInputHtml(e){var t=e.name||"",o=e.placeholder||"",i=e.iso||"",r=e.id||"111",l=e.value||"",a=e.disabled?"disabled":"",e=e.required?'data-tilda-req="1"':"",n=Math.floor(99999*Math.random()).toString(),i='<input type="tel" autocomplete="tel" name="'+t+'" id="input_'+r+'" data-phonemask-init="no" data-phonemask-id="'+n+'" data-phonemask-lid="'+r+'" data-phonemask-maskcountry="'+i+'" class="t-input tlk-input js-phonemask-input js-tilda-rule" value="'+l+'" disabled="'+a+'" placeholder="'+o+'" aria-describedby="error_'+r+'" '+e+">";return a?i:'<div id="rec'+n+'" class="tlk-popup__item tlk-form__item"><div class="t-input-group" data-input-lid="'+r+'" data-field-async="true" data-field-type="ph" data-field-name="'+t+'"><div class="t-input-block">'+i+'</div><div class="t-input-error tlk-input-error" aria-live="polite" id="error_'+r+'"></div></div></div>'}function tmst_profile__submitEditProfile(t,o){try{tmst_profile__updateSaveButtonState("loading");var i,e=tmst_profile__validateForm(t);0<e.length?(tmst_profile__showValidationErrors(t,e),tmst_profile__updateSaveButtonState("default")):(i=tmst_profile__collectFormData(t,o),tmst_profile__handleCaptchaIfNeeded(t,i,function(e){e||tmst_profile__sendEditProfileRequest(i,t,function(e){tmst_profile__handleResponse(e,t,o)})}))}catch(e){console.error("Error submitting profile:",e),tmst_profile__updateSaveButtonState("error"),setTimeout(function(){tmst_profile__updateSaveButtonState("default")},1e3)}}function tmst_profile__updateSaveButtonState(e){var t=document.querySelector(".js-profile-save");t&&(t.outerHTML=tmst_profile__getSaveButtonHTML(e))}function tmst_profile__validateForm(e){return tma__resetErrorFields(e),tma__resetErrorRequest(e),tma__validationFormFields(e)}function tmst_profile__showValidationErrors(e,t){tma__showErrorFields(e,t,"userbar_dict")}function tmst_profile__collectFormData(e,t){var o=tma__getProfileObjFromLS(),o=Object.assign({name:o.name,login:o.login,phone:o.phone,memberlogo:o.memberlogo_uuid,projectid:o.projectid,token:o.token,tzoffset:window.tildaMembers.timezoneOffset||(new Date).getTimezoneOffset()},tma__serializeArray(e)),e=e.querySelector(".tlk-profile__change-lang");return e&&window.tildaMembers.userLang!==e.value&&(o.lang=e.value),t&&t.additionalData&&Object.assign(o,t.additionalData),o.memberlogo=window.tildaMembers.upload.id,o}function tmst_profile__sendEditProfileRequest(e,t,o){t=t.querySelector('button[type="submit"]');tma__request("/api/editprofile/",JSON.stringify(e),t,o)}function tmst_profile__handleResponse(e,t,o){"ok"===e.status&&"object"==typeof e.data?tmst_profile__handleSuccessResponse(e,t,o):tmst_profile__handleErrorResponse(e,t)}function tmst_profile__handleSuccessResponse(e,t,o){var i=o||{},r=tma__getProfileObjFromLS(),o=e.data;function l(e){return e?e.replace(/[^\d]/g,""):""}var e=t.querySelector(".tlk-profile__change-lang"),e=e&&e.value!==window.tildaMembers.userLang,a=void 0===r.allowEditProfile||r.allowEditProfile,n=t.querySelector('input[name="login"]'),n=r.login!==n.value&&getIsLoginFieldDisabled({login:n.value,allowEditProfile:a}),t=t.querySelector('input[name="phone"]'),t=l(r.phone)!==l(t.value)&&getIsPhoneFieldDisabled({phone:t.value,allowEditProfile:a});i.needReload=e||n||t,Object.assign(r,{name:o.name,login:o.login,emailneedcaptcha:o.emailneedcaptcha,phoneneedcaptcha:o.phoneneedcaptcha,phone:o.phone||r.phone,memberlogo:o.memberlogo||"",memberlogo_uuid:o.memberlogo_uuid||""}),o.phone&&"function"==typeof tma__validatePhone?tma__validatePhone(o.phone.toString()).then(function(e){r.isPhoneValid=e,tmst_profile__finalizeProfileUpdate(r,i)}):tmst_profile__finalizeProfileUpdate(r,i)}function tmst_profile__finalizeProfileUpdate(e,t){setTimeout(function(){tmst_profile__updateSaveButtonState("success"),isFormChanged=!1,setTimeout(function(){tmst_profile__updateSaveButtonState("default")},1e3)},1e3);var o="tilda_members_profile"+e.projectid;localStorage.setItem(o,JSON.stringify(e)),localStorage.setItem(o+"_timestamp",Math.floor(Date.now()/1e3).toString()),t.needReload?setTimeout(function(){window.location.reload()},1e3):tma__userbar__updateDataProfile(),t&&"function"==typeof t.onSuccess&&t.onSuccess()}function tmst_profile__handleErrorResponse(e,t){e=e.code||e.data;"need_captcha"===e?tmst__profile__showRecaptcha(t):(tma__showErrorRequest(t,e,"userbar_dict","edit_profile"),tmst_profile__updateSaveButtonState("default"))}function tmst__profile__showRecaptcha(t){function o(e){tmst__profile__handleRecaptcha(e,t)&&window.removeEventListener("message",o)}tmst__profile__drawCaptcha(function(){window.removeEventListener("message",o)}),window.addEventListener("message",o)}function tmst__profile__drawCaptcha(e){var t,o=document.getElementById("allrecords");o&&(o.insertAdjacentHTML("beforeend",tmst__profile__getRecaptchaHtml()),t=document.querySelector(".tlk-recaptcha"))&&t.querySelector(".tlk-recaptcha__close").addEventListener("click",function(){tmst__profile__closeRecaptcha(t),"function"==typeof e&&e()})}function tmst__profile__closeRecaptcha(e){e&&e.remove()}function tmst__profile__handleRecaptcha(e,t){var o,i;return-1!==e.origin.indexOf(window.tildaMembers.endpoint)&&!!(o=document.querySelector(".tlk-recaptcha"))&&((i=o.querySelector(".tlk-recaptcha__reg-captcha"))&&i.contentWindow&&i.contentWindow.postMessage("tilda-reset","*"),tmst_profile__submitEditProfile(t,{additionalData:{rkey:e.data}}),tmst__profile__closeRecaptcha(o),!0)}function tmst__profile__setupRecaptchaHandler(t){function o(e){tmst__profile__handleRecaptcha(e,t)&&window.removeEventListener("message",o)}tmst__profile__drawCaptcha(function(){window.removeEventListener("message",o)}),window.addEventListener("message",o)}function tmst_profile__handleCaptchaIfNeeded(e,t,o){var i=tma__getProfileObjFromLS(),r=i.phoneneedcaptcha&&t.phone!==i.phone,i=i.emailneedcaptcha&&t.login!==i.login;t.rkey||!r&&!i?o(!1):(tmst__profile__setupRecaptchaHandler(e),o(!0))}function tmst__profile__getRecaptchaHtml(){return'<div class="tlk-recaptcha"><button type="button" class="tlk-recaptcha__close tlk-btn_reset"></button><iframe class="tlk-recaptcha__reg-captcha" src="'+window.tildaMembers.endpoint+"/api/getrecaptcha/?lang="+window.tildaMembers.userLang+'"></iframe></div>'}function tmst_profile__redirectToProfilePage(){window.tildaMembers.upload||(window.tildaMembers.upload={}),document.addEventListener("click",function(e){e.target instanceof HTMLElement&&e.target.classList.contains("tlk-userbar__popup-edit-profile")&&document.location.assign("/members/profile/")})}
